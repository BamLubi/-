<!--miniprogram/pages/index/index.wxml-->
<import src="../template/template" />

<!-- 地点选择 -->
<block wx:if="{{isChangePlace}}">
    <view class="mask bg-black"></view>
    <view class="choosePosition shadow shadow-lg bg-white" style="margin-top: {{windowHeight*0.25}}px;height: {{windowHeight/2}}px">
        <view>
            <!-- 关闭窗口 -->
            <view class="close">
                <image src="/images/close.png" bindtap="HideMask"></image>
            </view>
            <!-- 标题 -->
            <view class="title">更换地点</view>
        </view>
        <!-- 第一行地点 -->
        <view class="info bg-gray" style="height: {{windowHeight/13}}px;">
            <!-- 起点 -->
            <view>
                <picker bindchange="PickerChange" value="{{positionStartIndex}}" range="{{position}}">
                    <text>{{position[positionStartIndex]}}</text>
                </picker>
            </view>
            <!-- 转换 -->
            <image src="/images/change.png" style="width: 30px;height: 30px;margin: 0px 0px 0px 0px;" bindtap="changeDirection"></image>
            <!-- 终点 -->
            <view>
                <picker bindchange="PickerChange" value="{{positionEndIndex}}" range="{{position}}">
                    <text>{{position[positionEndIndex]}}</text>
                </picker>
            </view>
        </view>
        <!-- 第二行日期 -->
        <view class="info bg-gray" style="height: {{windowHeight/13}}px;">
            <picker mode="date" value="{{date}}" start="{{todayDate.year}}-{{todayDate.month}}-{{todayDate.day}}" end="2022-09-01" bindchange="DateChange">
                <text>{{dateZN}}<text wx:if="{{selectDate.year == todayDate.year && selectDate.month == todayDate.month && selectDate.day == todayDate.day}}" style="font-size: 18px;">(今天)</text>
                <text wx:if="{{selectDate.year == todayDate.year && selectDate.month == todayDate.month && selectDate.day == todayDate.day+1}}" style="font-size: 18px;">(明天)</text>
                <text wx:if="{{selectDate.year == todayDate.year && selectDate.month == todayDate.month && selectDate.day == todayDate.day+2}}" style="font-size: 18px;">(后天)</text></text>
            </picker>
            <view></view>
            <view></view>
        </view>
        <!-- 第三行时间段 -->
        <view class="info bg-gray" style="height: {{windowHeight/13}}px;">
            <!-- 当天显示当前时间-22:00 -->
            <block wx:if="{{selectDate.year == todayDate.year && selectDate.month == todayDate.month && selectDate.day == todayDate.day}}">
                <picker mode="time" value="{{time}}" start="{{selectDate.hour}}:{{selectDate.minutes<10?'0'+selectDate.minutes:selectDate.minutes}}" end="22:00" bindchange="TimeChange">
                    <text>{{selectDate.hour<10?"0"+selectDate.hour:selectDate.hour}}:{{selectDate.minutes<10?"0"+selectDate.minutes:selectDate.minutes}}<text class="text-red"> - 22:00</text></text>
                </picker>
                <view></view>
                <view></view>
            </block>
            <!-- 除当天，显示7:00-22:00 -->
            <block wx:else>
                <picker mode="time" value="{{time}}" start="07:00" end="22:00" bindchange="TimeChange">
                    <text>{{selectDate.hour<10?"0"+selectDate.hour:selectDate.hour}}:{{selectDate.minutes<10?"0"+selectDate.minutes:selectDate.minutes}}<text class="text-red"> - 22:00</text></text>
                </picker>
                <view></view>
                <view></view>
            </block>
        </view>
        <!-- 按钮 -->
        <button class="cu-btn bg-orange round lg shadow shadow-blur" bindtap="Search">查询</button>
    </view>
</block>

<!-- 顶部导航 -->
<view class="head bg-gradual-blue" bindtap="ShowMask">
    <text class="destination">{{position[positionStartIndex]}}</text>
    <image src="/images/row3.png" style="width: 30px;height: 23px;margin: 5px 10px 5px 10px;" ></image>
    <text class="destination">{{position[positionEndIndex]}}</text>
    <image src="/images/unfold.png" style="width: 16px;height: 16px;margin: 5px 0px 5px 10px;"></image>
</view>

<!-- 消息 -->
<van-notice-bar speed="20" text="欢迎使用南工校车，本小程序非官方所有。当前时间{{dateZN}}星期{{selectDate.week}}" />

<!-- 车辆信息 -->
<scroll-view scroll-y style="height: {{windowHeight-100}}px;">
    <view>
        <!-- 有班车 -->
        <block wx:if="{{hasBus}}">
            <!-- 列表渲染 -->
            <view wx:for="{{busLineShow}}" wx:key="unique" class="busList">
                <!-- 准点发车 -->
                <block wx:if="{{item.status == 1}}">
                    <template is='busLineOnTime' data='{{...item}}' />
                </block>
                <!-- 循环发车 -->
                <block wx:if="{{item.status != 1}}">
                    <template is='busLineCircle' data='{{...item}}' />
                </block>
            </view>
        </block>
        <!-- 无班车 -->
        <block wx:if="{{!hasBus}}">
            <view class="body radius shadow-warp bg-white">
                <text class="text-shadow text-blue" style="font-size: 17px;margin: 5px 0px 5px 0px;">当前班车休息中</text>
            </view>
        </block>
    </view>
</scroll-view>

<!-- 底部信息 -->
<view class="bottom">
    <text>Copyright © 2019 小陆斑比 </text>
</view>